# -*- coding:utf-8 -*-

import os
import  pandas as pd
import xlrd
# import xlwt
import pandas

label_pre =dict()
label_correct = {}

def correct_label(base_path):
    global label_correct
    for root, _dir, files in os.walk(base_path):
        print(root,"---", _dir, "--", files)
        if not files: continue
        else:
            if root.split("\\")[-1] == 'test': continue
            # if root.split('\\')[-1] == 'others': continue
            for img in files:
                label_correct[img.split(".")[0]] = root.split("\\")[-1]# .split('.')[0]
    else:
        # label_correct = sorted(label_correct)
        print("correct_label =", label_correct)
    # print(lable_correct.values())
    # print("test" not in list(lable_correct.values()))

def predict_label(path):
    global label_pre
    assert ".xls" in path
    exl = xlrd.open_workbook(path)  # 打开exl表格
    sheet_cur = exl.sheet_by_index(0)
    row_num = sheet_cur.nrows
    data = {}
    for i in range(1, row_num):
        info = sheet_cur.row_values(i)
        # print(info)
        img = info[0].split("/")[-1].split(".")[0]
        pre_label = info[1]
        label_pre.setdefault(img, pre_label)
    else:
        # label_pre = sorted(label_pre)
        print('label_pre =', label_pre)


def cal_test_acc1():
    global label_pre, label_correct
    sum = 0; correct_sum = 0
    for img in label_pre.keys():
        try:
            if label_pre[img] == label_correct[img]:
                correct_sum += 1
            sum += 1
        except: pass
    print("correct_sum", correct_sum)
    print("sum", sum)
    print("test_acc1: ", correct_sum/sum)


# correct_label(r'C:\work_code\bill_image_classification\ApplicationFormClassification\dataset\ApplicationForm\test')
correct_label(r"C:\Users\yahuu\Desktop\3分类模型用\test")
predict_label("C:\\Users\\yahuu\\Desktop\\2019-11-12-15-11_resnet18__95_98.2456.xls")
print("corr_label", len(label_correct.keys()))
print("pre_label", len(label_pre.keys()))
cal_test_acc1()
# print(label_pre)
# print(label_correct)

# label__pre = {'57809748802554.JPG': 'Check', '57110148340374.JPG': 'PersonalCustomerRemittanceApplication', '17248052277235.JPG': 'Check', '33125135833498.JPG': 'PersonalCertificatesOfDeposit', '34650744887613.JPG': 'PersonalAccountsAndIntegratedServicesApplicationForm', '8405755672403.JPG': 'WrongAccountApplication', '2853632357954.JPG': 'TemporaryDebtCertificate', '8413265119608.JPG': 'WrongAccountApplication', '279062601042087.JPG': 'Check', '17462412643988.JPG': 'Domestic-foreignExchangeApplication', '7618874311253.JPG': 'TemporaryDebtCertificate', '77408620504941.JPG': 'WrongAccountApplication', '43590135345080.JPG': 'WrongAccountApplication', '108432511731.jpg': 'HeadOfficeSettlementApplication', '34351023878409.JPG': 'WrongAccountApplication', '18775340633895.JPG': 'PersonalCertificatesOfDeposit', '33226038172111.JPG': 'WrongAccountApplication', '199125812799995.JPG': 'WrongAccountApplication', '22604921343919.JPG': 'PassbookExchange', '97525085220682.JPG': 'Domestic-foreignExchangeApplication', '26676759091975.JPG': 'PersonalCertificatesOfDeposit', '24983526096931.JPG': 'Check', '55234385948586.JPG': 'PersonalAccountsAndIntegratedServicesApplicationForm', '82763516015096.JPG': 'PersonalCertificatesOfDeposit', '32451265320753.JPG': 'PassbookExchange', '69568006183939.JPG': 'TemporaryDebtCertificate', '17449540746447.JPG': 'WrongAccountApplication', '74748040672335.JPG': 'TemporaryDebtCertificate', '24804917710499.JPG': 'PersonalAccountsAndIntegratedServicesApplicationForm', '77345323583073.JPG': 'PersonalCustomerLossReport', '279501681264090.JPG': 'PersonalCertificatesOfDeposit', '49080254500829.JPG': 'WrongAccountApplication', '76725958672823.JPG': 'TemporaryDebtCertificate', '1367049933378.JPG': 'WrongAccountApplication', '54310120156003.JPG': 'PersonalAccountsAndIntegratedServicesApplicationForm', '34258424891586.JPG': 'WrongAccountApplication', '100285105452779.JPG': 'PersonalCertificatesOfDeposit', '12686427062832.JPG': 'CashPaymentSlip', '19208838955718.JPG': 'Check', '92775495896429.JPG': 'PersonalCertificatesOfDeposit', '57144739143535.JPG': 'Check', '33385609143323.JPG': 'WrongAccountApplication', '29179773645609.JPG': 'WrongAccountApplication', '12813770545809.JPG': 'Check', '33855568071258.JPG': 'WrongAccountApplication', '10457241943011.JPG': 'PersonalAccountsAndIntegratedServicesApplicationForm', '94914967163722.JPG': 'PersonalAccountsAndIntegratedServicesApplicationForm', '19483644324169.JPG': 'TemporaryDebtCertificate', '98172348418233.JPG': 'WrongAccountApplication', '12727212013576.JPG': 'Check', '15315065290995.JPG': 'Domestic-foreignExchangeApplication', '297696905710.JPG': 'Check', '90888406619195.JPG': 'PersonalCertificatesOfDeposit', '66548919376302.JPG': 'PassbookExchange', '23212087083846.JPG': 'TemporaryDebtCertificate', '13557592623333.JPG': 'PersonalCustomerLossReport', '4790569235523.JPG': 'PersonalAccountsAndIntegratedServicesApplicationForm', '33383717528974.JPG': 'PassbookExchange', '118586967988258.JPG': 'PersonalCertificatesOfDeposit', '116165009960.JPG': 'PersonalCustomerLossReport', '22172870913953.JPG': 'TemporaryDebtCertificate', '19087409513546.JPG': 'PassbookExchange', '75219838231525.JPG': 'WrongAccountApplication', '7622459218255.JPG': 'TemporaryDebtCertificate', '17225174986288.JPG': 'WrongAccountApplication', '213417676213852.JPG': 'PassbookExchange', '51992226227443.JPG': 'Check', '7541197640950.JPG': 'PersonalCustomerLossReport', '9349136849694.JPG': 'PersonalCustomerLossReport', '6768353627445.JPG': 'TemporaryDebtCertificate', '32831452039208.JPG': 'WrongAccountApplication', '18028408213846.JPG': 'PassbookExchange', '96135585864552.JPG': 'PersonalAccountsAndIntegratedServicesApplicationForm', '2087129256033.JPG': 'Check', '1320607715884.JPG': 'WrongAccountApplication', '147227069081.JPG': 'Check', '23706111227142.JPG': 'Check', '80516166970379.JPG': 'ForeignExchangeBillOfWater', '99218921008974.JPG': 'PassbookExchange', '57266331592579.JPG': 'PassbookExchange', '28332125691576.JPG': 'TemporaryDebtCertificate', '12533715554774.JPG': 'Check', '2021481483930.JPG': 'PersonalAccountsAndIntegratedServicesApplicationForm', '11309270061619.JPG': 'PersonalAccountsAndIntegratedServicesApplicationForm', '12186354189006.JPG': 'CashPaymentSlip', '95824997984689.JPG': 'WrongAccountApplication', '12592641481277.JPG': 'WrongAccountApplication', '18277108697310.JPG': 'PersonalCustomerRemittanceApplication', '23220978088723.JPG': 'PassbookExchange', '187796113992477.JPG': 'PersonalCertificatesOfDeposit', '75065776378083.JPG': 'PersonalAccountsAndIntegratedServicesApplicationForm', '15496824621959.JPG': 'LocalSettlementBusinessApplication', '24966866622119.JPG': 'WrongAccountApplication', '59767040659060.JPG': 'WrongAccountApplication', '47600306682082.JPG': 'PassbookExchange', '32272973800222.JPG': 'WrongAccountApplication', '3032115492080.JPG': 'PersonalAccountsAndIntegratedServicesApplicationForm', '17322914224814.JPG': 'PersonalCustomerLossReport', '142320854920930.JPG': 'Check', '99413405706775.JPG': 'PersonalAccountsAndIntegratedServicesApplicationForm', '33176767652904.JPG': 'PersonalAccountsAndIntegratedServicesApplicationForm', '76313959435238.JPG': 'WrongAccountApplication', '27162247171671.JPG': 'Check', '32259559240949.JPG': 'PersonalCertificatesOfDeposit', '14729363930210.JPG': 'CertificateOfDepositApplication', '18089810811307.JPG': 'PersonalCertificatesOfDeposit', '1264113090153.JPG': 'CashPaymentSlip', '95832832095981.JPG': 'Check', '13431769231364.JPG': 'WrongAccountApplication', '27835865994206.JPG': 'Domestic-foreignExchangeApplication', '66642304932397.JPG': 'PassbookExchange', '66361727032148.JPG': 'PersonalCustomerLossReport', '15279209240024.JPG': 'PersonalAccountsAndIntegratedServicesApplicationForm', '6006683408102.JPG': 'PersonalCustomerLossReport', '1055703749389.JPG': 'TemporaryDebtCertificate', '258165321344423.JPG': 'PersonalCertificatesOfDeposit', '37122377097316.JPG': 'PassbookExchange', '198689751370516.JPG': 'WrongAccountApplication', '18537715326436.JPG': 'WrongAccountApplication', '99724328938312.JPG': 'PassbookExchange', '72493053965724.JPG': 'TemporaryDebtCertificate', '10589285418070.JPG': 'PersonalAccountsAndIntegratedServicesApplicationForm', '33700818228293.JPG': 'TemporaryDebtCertificate', '99483124859326.JPG': 'PassbookExchange', '201000023636591.JPG': 'PassbookExchange', '39444466987004.JPG': 'Check', '258478909481.JPG': 'ForeignExchangeBillOfWater', '88595966562405.JPG': 'Check', '94052291732091.JPG': 'Check', '18006637129848.JPG': 'PersonalAccountsAndIntegratedServicesApplicationForm', '58637030781410.JPG': 'CertificateOfDepositApplication', '32350599187763.JPG': 'TemporaryDebtCertificate', '31434793186342.JPG': 'Domestic-foreignExchangeApplication', '44346448208577.JPG': 'PersonalAccountsAndIntegratedServicesApplicationForm', '142807381641022.JPG': 'WrongAccountApplication', '24006149010977.JPG': 'WrongAccountApplication', '43925181489385.JPG': 'WrongAccountApplication', '96992095991711.JPG': 'Check', '6248355840892.JPG': 'PassbookExchange', '98839407344377.JPG': 'PassbookExchange', '33330128622022.JPG': 'PersonalAccountsAndIntegratedServicesApplicationForm', '4997054519195.JPG': 'LocalSettlementBusinessApplication', '48906647138500.JPG': 'HeadOfficeSettlementApplication', '194035680345828.JPG': 'PassbookExchange', '2093024656694.JPG': 'CashPaymentSlip', '22771151353266.JPG': 'PassbookExchange', '8445711404470.JPG': 'WrongAccountApplication', '94262940738437.JPG': 'CashPaymentSlip', '2603423214216.JPG': 'PersonalCertificatesOfDeposit', '50779516918559.JPG': 'PersonalAccountsAndIntegratedServicesApplicationForm', '47323755616852.JPG': 'TemporaryDebtCertificate', '6257904487311.JPG': 'PersonalCertificatesOfDeposit', '57651815487434.JPG': 'LocalSettlementBusinessApplication', '193865373402801.JPG': 'TemporaryDebtCertificate', '11345555291211.JPG': 'PersonalAccountsAndIntegratedServicesApplicationForm', '25952459396128.JPG': 'TemporaryDebtCertificate', '26378346531987.JPG': 'PassbookExchange', '57195821179952.JPG': 'WrongAccountApplication'}
# correct_label = {'12533715554774.JPG': 'Check', '279062601042087.JPG': 'Check', '39444466987004.JPG': 'Check', '51992226227443.JPG': 'Check', '57144739143535.JPG': 'Check', '88595966562405.JPG': 'Check', '96992095991711.JPG': 'Check', '17462412643988.JPG': 'Domestic-foreignExchangeApplication', '97525085220682.JPG': 'Domestic-foreignExchangeApplication', '258478909481.JPG': 'ForeignExchangeBillOfWater', '15496824621959.JPG': 'LocalSettlementBusinessApplication', '4997054519195.JPG': 'LocalSettlementBusinessApplication', '100285105452779.JPG': 'others', '10457241943011.JPG': 'others', '1055703749389.JPG': 'others', '10589285418070.JPG': 'others', '108432511731.JPG': 'others', '11309270061619.JPG': 'others', '11345555291211.JPG': 'others', '118586967988258.JPG': 'others', '12186354189006.JPG': 'others', '12592641481277.JPG': 'others', '1264113090153.JPG': 'others', '12686427062832.JPG': 'others', '12727212013576.JPG': 'others', '12813770545809.JPG': 'others', '1320607715884.JPG': 'others', '13431769231364.JPG': 'others', '1367049933378.JPG': 'others', '142320854920930.JPG': 'others', '142807381641022.JPG': 'others', '147227069081.JPG': 'others', '14729363930210.JPG': 'others', '15315065290995.JPG': 'others', '17225174986288.JPG': 'others', '17248052277235.JPG': 'others', '17449540746447.JPG': 'others', '18006637129848.JPG': 'others', '18028408213846.JPG': 'others', '18089810811307.JPG': 'others', '18537715326436.JPG': 'others', '18775340633895.JPG': 'others', '19087409513546.JPG': 'others', '19208838955718.JPG': 'others', '193865373402801.JPG': 'others', '194035680345828.JPG': 'others', '19483644324169.JPG': 'others', '198689751370516.JPG': 'others', '199125812799995.JPG': 'others', '201000023636591.JPG': 'others', '2021481483930.JPG': 'others', '2087129256033.JPG': 'others', '2093024656694.JPG': 'others', '213417676213852.JPG': 'others', '22172870913953.JPG': 'others', '23212087083846.JPG': 'others', '23220978088723.JPG': 'others', '23706111227142.JPG': 'others', '24006149010977.JPG': 'others', '24966866622119.JPG': 'others', '24983526096931.JPG': 'others', '258165321344423.JPG': 'others', '25952459396128.JPG': 'others', '26378346531987.JPG': 'others', '26676759091975.JPG': 'others', '27162247171671.JPG': 'others', '27835865994206.JPG': 'others', '279501681264090.JPG': 'others', '28332125691576.JPG': 'others', '2853632357954.JPG': 'others', '29179773645609.JPG': 'others', '297696905710.JPG': 'others', '3032115492080.JPG': 'others', '31434793186342.JPG': 'others', '32272973800222.JPG': 'others', '32350599187763.JPG': 'others', '32451265320753.JPG': 'others', '32831452039208.JPG': 'others', '33125135833498.JPG': 'others', '33226038172111.JPG': 'others', '33330128622022.JPG': 'others', '33385609143323.JPG': 'others', '33700818228293.JPG': 'others', '33855568071258.JPG': 'others', '34258424891586.JPG': 'others', '34351023878409.JPG': 'others', '34650744887613.JPG': 'others', '43590135345080.JPG': 'others', '43925181489385.JPG': 'others', '44346448208577.JPG': 'others', '47323755616852.JPG': 'others', '4790569235523.JPG': 'others', '48906647138500.JPG': 'others', '49080254500829.JPG': 'others', '50779516918559.JPG': 'others', '54310120156003.JPG': 'others', '55234385948586.JPG': 'others', '57110148340374.JPG': 'others', '57195821179952.JPG': 'others', '57266331592579.JPG': 'others', '57651815487434.JPG': 'others', '57809748802554.JPG': 'others', '58637030781410.JPG': 'others', '59767040659060.JPG': 'others', '6257904487311.JPG': 'others', '6768353627445.JPG': 'others', '69568006183939.JPG': 'others', '72493053965724.JPG': 'others', '74748040672335.JPG': 'others', '75065776378083.JPG': 'others', '75219838231525.JPG': 'others', '7618874311253.JPG': 'others', '7622459218255.JPG': 'others', '76313959435238.JPG': 'others', '76725958672823.JPG': 'others', '77408620504941.JPG': 'others', '80516166970379.JPG': 'others', '82763516015096.JPG': 'others', '8405755672403.JPG': 'others', '8413265119608.JPG': 'others', '8445711404470.JPG': 'others', '94052291732091.JPG': 'others', '94262940738437.JPG': 'others', '95824997984689.JPG': 'others', '95832832095981.JPG': 'others', '96135585864552.JPG': 'others', '98172348418233.JPG': 'others', '98839407344377.JPG': 'others', '99218921008974.JPG': 'others', '99413405706775.JPG': 'others', '99483124859326.JPG': 'others', '99724328938312.JPG': 'others', '22604921343919.JPG': 'PassbookExchange', '22771151353266.JPG': 'PassbookExchange', '33383717528974.JPG': 'PassbookExchange', '37122377097316.JPG': 'PassbookExchange', '47600306682082.JPG': 'PassbookExchange', '6248355840892.JPG': 'PassbookExchange', '66548919376302.JPG': 'PassbookExchange', '66642304932397.JPG': 'PassbookExchange', '15279209240024.JPG': 'PersonalAccountsAndIntegratedServicesApplicationForm', '24804917710499.JPG': 'PersonalAccountsAndIntegratedServicesApplicationForm', '33176767652904.JPG': 'PersonalAccountsAndIntegratedServicesApplicationForm', '94914967163722.JPG': 'PersonalAccountsAndIntegratedServicesApplicationForm', '187796113992477.JPG': 'PersonalCertificatesOfDeposit', '2603423214216.JPG': 'PersonalCertificatesOfDeposit', '32259559240949.JPG': 'PersonalCertificatesOfDeposit', '90888406619195.JPG': 'PersonalCertificatesOfDeposit', '92775495896429.JPG': 'PersonalCertificatesOfDeposit', '116165009960.JPG': 'PersonalCustomerLossReport', '13557592623333.JPG': 'PersonalCustomerLossReport', '17322914224814.JPG': 'PersonalCustomerLossReport', '6006683408102.JPG': 'PersonalCustomerLossReport', '66361727032148.JPG': 'PersonalCustomerLossReport', '7541197640950.JPG': 'PersonalCustomerLossReport', '77345323583073.JPG': 'PersonalCustomerLossReport', '9349136849694.JPG': 'PersonalCustomerLossReport', '18277108697310.JPG': 'PersonalCustomerRemittanceApplication'}
# l = '108432511731.JPG'
# n = '108432511731.jpg'
# print(n in label_pre.keys())
# print(l in correct_label.keys())
